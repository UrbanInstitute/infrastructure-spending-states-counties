{
  "hash": "5fd7ff3c07b6663780e09d856d561b81",
  "result": {
    "markdown": "---\ntitle: \"PERC - Exploratory data analysis\"\nformat:\n  html:\n    code-fold: false\n    code-summary: \"Show the code\"\n    highlight-style: github\n---\n\n\nWe have some preliminary data from Yonah Freemark for the PERC project and here I'd like to run through it a bit and see what we are working with. Yonah's email describes the structure of the Excel file and its tables like so:\n\n-   Dictionary: Explains the variables\n-   States: Information for each of the states (program funding levels could be put on map)\n-   Counties: Information for all counties (program funding levels could be put on map)\n-   State quintiles: Quintiles of funding for HUD and IIJA programs by underlying demographic characteristic (could be used for graph on sidebar)\n-   County quintiles: Quintiles of funding for HUD and IIJA programs by underlying demographic characteristic (could be used for graph on sidebar). Note that this is broken down for (a) all counties; (b) metro counties; (c) highly urbanized counties (which are a subset of metro counties)\n\n## Libraries\n\nLet's load the libraries we'll need to explore this data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(here)\n# load tigris library for loading Census geographic files\nlibrary(tigris)\n# set option to use cache where possible\noptions(tigris_use_cache = TRUE)\n```\n:::\n\n\n## Load data tables\n\nLet's load each table in the sheet as a dataframe so we can see what we are working with.\n\n### Dictionary\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndictionary_table <- read_csv(here(\"data/output\", \"dictionary.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 79 Columns: 2\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (2): Variable, Meaning\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\n\n### States\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstates_table <- read_csv(here(\"data/output\", \"states.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 52 Columns: 83\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (7): GISJOIN, YEAR, STUSAB, STATE, GEOID, NAME, FIPS\ndbl (76): STATEA, pop, race_nh_white, race_nh_black, race_nh_asian, race_his...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\n\n### Counties\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounties_table <- read_csv(here(\"data/output\", \"counties.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 3221 Columns: 89\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (8): GISJOIN, YEAR, STUSAB, STATE, COUNTY, GEOID, NAME, FIPS\ndbl (81): STATEA, COUNTYA, pop, race_nh_white, race_nh_black, race_nh_asian,...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\n\n### State quintiles\n\nHUD funding:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstate_quintiles_hud_table <- read_csv(here(\"data/output\", \"state_quintiles_hud.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 15 Columns: 6\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (1): Item\ndbl (5): Q1, Q2, Q3, Q4, Q5\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\n\nIIJA funding:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstate_quintiles_iija_table <- read_csv(here(\"data/output\", \"state_quintiles_iija.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 15 Columns: 6\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (1): Item\ndbl (5): Q1, Q2, Q3, Q4, Q5\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\n\n### County quintiles\n\nHUD funding:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounty_quintiles_hud_table <- read_csv(here(\"data/output\", \"county_quintiles_hud.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 48 Columns: 7\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (2): Subset, Item\ndbl (5): Q1, Q2, Q3, Q4, Q5\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\nIIJA funding:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounty_quintiles_iija_table <- read_csv(here(\"data/output\", \"county_quintiles_iija.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 48 Columns: 7\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (2): Subset, Item\ndbl (5): Q1, Q2, Q3, Q4, Q5\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\n\n## Basic county and state distributions\n\nLet's just get a sense of the main 2 funding variables at the state and county level. Specifically, based on the dictionary, we want to look at `iija_formula_per_cap` and `hud_per_cap`. Although it seem that instead of a column for `iija_formula_per_cap` we have `iija_per_cap` in the state dataset. I am going to assume that this is the same variable with a different label for now.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstates_table %>% \n  ggplot(aes(x = iija_per_cap)) +\n  geom_histogram(binwidth = 200, fill = \"#1696D2\") +\n  theme_minimal() +\n  labs(\n    title = \"Distribution of State-level IIJA funding per capita\"\n  )\n```\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-html/plot-state-distribution-iija-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstates_table %>% \n  ggplot(aes(x = hud_per_cap)) +\n  geom_histogram(binwidth = 200, fill = \"#1696D2\") +\n  theme_minimal() +\n  labs(\n    title = \"Distribution of State-level HUD funding per capita\"\n  )\n```\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-html/plot-state-distribution-hud-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncounties_table %>% \n  ggplot(aes(x = iija_formula_per_cap)) +\n  geom_histogram(fill = \"#1696D2\") +\n  theme_minimal() +\n  labs(\n    title = \"Distribution of County-level IIJA funding per capita\"\n  )\n```\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-html/plot-county-distribution-iija-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncounties_table %>% \n  ggplot(aes(x = hud_per_cap)) +\n  geom_histogram(fill = \"#1696D2\") +\n  theme_minimal() +\n  labs(\n    title = \"Distribution of County-level HUD funding per capita\"\n  )\n```\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-html/plot-county-distribution-hud-1.png){width=672}\n:::\n:::\n\n\n## Clean up quintiles\n  \nIn order to visualize more easily, we need to re-organize the quintile data a bit. Let's start with the state-level data, since that is a bit easier.\n  \n\n::: {.cell}\n\n```{.r .cell-code}\nstate_quintiles_hud_longer <- state_quintiles_hud_table %>% \n  pivot_longer(\n    cols = Q1:Q5,\n    names_to = \"quintile\",\n    values_to = \"funding_per_capita\",\n  ) %>%\n  mutate(\n    quintile = fct_rev(factor(quintile))\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstate_quintiles_hud_longer %>%\n  ggplot(aes(x = funding_per_capita, y = quintile)) +\n  geom_col(fill = \"#1696D2\") +\n  facet_wrap(~ Item) +\n  theme_minimal() +\n  labs(\n    title = \"State-level HUD Funding per capita\"\n  )\n```\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-html/plot-state-quintiles-hud-1.png){width=672}\n:::\n:::\n\n\nNow let's do the same thing with the IIJA funding.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstate_quintiles_iija_longer <- state_quintiles_iija_table %>% \n  pivot_longer(\n    cols = Q1:Q5,\n    names_to = \"quintile\",\n    values_to = \"funding_per_capita\",\n  ) %>%\n  mutate(\n    quintile = fct_rev(factor(quintile))\n  )\n```\n:::\n\n\nAnd let's plot those:\n  \n\n::: {.cell}\n\n```{.r .cell-code}\nstate_quintiles_iija_longer %>%\n  ggplot(aes(x = funding_per_capita, y = quintile)) +\n  geom_col(fill=\"#1696D2\") +\n  facet_wrap(~ Item) +\n  theme_minimal() +\n  labs(\n    title = \"State-level IIJA Funding per capita\"\n  )\n```\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-html/plot-state-quintiles-iija-1.png){width=672}\n:::\n:::\n\n\n\nThe county-level quintiles have a few different subsets of counties:\n\n- `All counties`\n- `CBSA counties`\n- `Urban counties`\n\nWe'll probably need to plot each of these separately. For now, let's `pivot_longer()` like we did for the states. First up, HUD funding:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounty_quintiles_hud_longer <- county_quintiles_hud_table %>% \n  pivot_longer(\n    cols = Q1:Q5,\n    names_to = \"quintile\",\n    values_to = \"funding_per_capita\",\n  ) %>%\n  mutate(\n    quintile = fct_rev(factor(quintile)),\n    Subset = factor(Subset),\n    Item = factor(Item),\n  )\n```\n:::\n\n\nNow IIJA funding:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounty_quintiles_iija_longer <- county_quintiles_iija_table %>% \n  pivot_longer(\n    cols = Q1:Q5,\n    names_to = \"quintile\",\n    values_to = \"funding_per_capita\",\n  ) %>%\n  mutate(\n    quintile = fct_rev(factor(quintile)),\n    Subset = factor(Subset),\n    Item = factor(Item),\n  )\n```\n:::\n\n\n### Plotting subsets\n\nLet's write a function to plot each subset of counties and grab all the subsets themselves:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_county_subset <- function(data, subset, funding_type) {\n  data %>%\n    filter(Subset == subset) %>%\n    ggplot(aes(x = funding_per_capita, y = quintile)) +\n    geom_col(fill=\"#1696D2\") +\n    facet_wrap(~ Item) +\n    theme_minimal() +\n    labs(\n      title = paste0(\"County-level \", funding_type, \" Funding per capita (\", subset, \")\")\n    )\n}\n\ncounty_subsets <- unique(county_quintiles_hud_longer$Subset)\n```\n:::\n\n\nAnd now let's plot each subset for HUD funding:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounty_subsets %>%\n  map(\\(subset) plot_county_subset(county_quintiles_hud_longer, subset, \"HUD\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[[1]]\n```\n:::\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-html/plot-county-quintiles-hud-1.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n[[2]]\n```\n:::\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-html/plot-county-quintiles-hud-2.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n[[3]]\n```\n:::\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-html/plot-county-quintiles-hud-3.png){width=672}\n:::\n:::\n\n\nAnd the same for IIJA funding:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounty_subsets %>%\n  map(\\(subset) plot_county_subset(county_quintiles_iija_longer, subset, \"IIJA\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[[1]]\n```\n:::\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-html/plot-county-quintiles-iija-1.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n[[2]]\n```\n:::\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-html/plot-county-quintiles-iija-2.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n[[3]]\n```\n:::\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-html/plot-county-quintiles-iija-3.png){width=672}\n:::\n:::\n\n\n## County funding maps\n\nThe main visual component of this tool will likely be a national map displaying funding per capita for different programs. Let's take a look at some of the data mapped out for reference.\n\nFirst let's grab some geographic data:\n\n::: {.cell}\n\n```{.r .cell-code}\n# load geography, filter out territories other than PR and apply Alaska and Hawaii shift\ncounties_geo <- counties(cb = TRUE, year = 2020) %>% \n  filter(\n    as.numeric(STATEFP) == 72 | as.numeric(STATEFP) < 60\n  ) %>%\n  shift_geometry()\n\n# join data to geography\ncounties_joined <- counties_geo %>% left_join(counties_table, by = c(\"GEOID\"=\"FIPS\"))\n```\n:::\n\n\nNow let's map some of these numbers and see what they look like. First IIJA:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounties_joined %>% \n  ggplot(aes(fill = iija_formula_per_cap)) +\n  geom_sf() +\n  scale_fill_viridis_c(option = \"magma\", trans = \"log\") +\n  theme_void() +\n  labs(\n    title = \"IIJA funding per capita by county\"\n  )\n```\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\nNow HUD:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounties_joined %>% \n  ggplot(aes(fill = hud_per_cap)) +\n  geom_sf() +\n  scale_fill_viridis_c(option = \"magma\", trans = \"log10\") +\n  theme_void() +\n  labs(\n    title = \"HUD funding per capita by county\"\n  )\n```\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\nAnd we can look at the state level data too just for kicks. Let's prepare the geographic data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstates_geo <- states(cb = TRUE, year = 2020) %>% \n\tfilter(\n\t\tas.numeric(STATEFP) == 72 | as.numeric(STATEFP) < 60\n\t) %>%\n\tshift_geometry()\n\nstates_joined <- states_geo %>% left_join(states_table, by = c(\"GEOID\"=\"FIPS\"))\n```\n:::\n\n\nFirst HUD:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstates_joined %>% \n  ggplot(aes(fill = hud_per_cap)) +\n  geom_sf() +\n  scale_fill_viridis_c(option = \"magma\", trans = \"log10\") +\n  theme_void() +\n  labs(\n    title = \"HUD funding per capita by states\"\n  )\n```\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n\nThen IIJA:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstates_joined %>% \n  ggplot(aes(fill = iija_per_cap)) +\n  geom_sf() +\n  scale_fill_viridis_c(option = \"magma\", trans = \"log10\") +\n  theme_void() +\n  labs(\n    title = \"IIJA funding per capita by states\"\n  )\n```\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n## Need factors for programs \n\nThe research team also wants to explore the relationship between program funding and an array of \"need\" measures. One ideas discussed was to weight the funding and need as percentiles and use the ratio between the two percentiles to understand where programs are potentially over or under funded for a given geography.\n\nThe research team gave the following description alongside the data:\n\n<blockquote>\nProgram Tab: \n\n- Columns A-G provide details on each federal program included in the analysis\n- Columns H-J provides which equity index (reference index tab) will be primarily used to assess the equity implications for each program\n\nIndex Tab: \n\n- Column A list the index while Column B lists the indicators making up each index and Column C provides the data source\n</blockquote>\n\nFor starters, let's load in the spreadsheet they sent and count up how many variables we are looking at per program. Here's the program table:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprogram_table <- read_csv(here(\"data/output\", \"programs.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 116 Columns: 11\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (10): type, program_name, category, agency_name, bureau_name, funding_me...\ndbl  (1): funding_amount\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\n\nThe index table's format leaves some empty cells for the `index_category`, and `indicator` columns, so let's fill those in along the way.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nneed_measure_index_table <- read_csv(here(\"data/output\", \"need_measure_index.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 51 Columns: 3\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (3): index_category, indicator, measure\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\n\nNow let's count up the number of variables per program:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nindex_counts <- need_measure_index_table %>%\n  group_by(index_category, indicator) %>%\n\tsummarise(\n\t\tnumber_of_measures = n()\n\t) %>%\n  group_by(index_category) %>%\n  summarise(\n    number_of_measures = sum(number_of_measures),\n\t\tnumber_of_indicators = n()\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'index_category'. You can override using\nthe `.groups` argument.\n```\n:::\n\n```{.r .cell-code}\nprogram_equity_measure_counts <- program_table %>% \n  left_join(index_counts, by = c(\"base_index\" = \"index_category\")) %>%\n  rename(\n     count_base_indicators = number_of_indicators,\n\t\t count_base_measures = number_of_measures\n  ) %>%\n  left_join(index_counts, by = c(\"primary_equity_index\" = \"index_category\")) %>%\n  rename(\n    count_equity_indicators = number_of_indicators,\n\t\tcount_equity_measures = number_of_measures\n  ) %>%\n  mutate(\n    total_indicators = count_base_indicators + count_equity_indicators,\n    total_measures = count_base_measures + count_equity_measures\n  )\t%>%\n  select(\n    type,\n    program_name,\n    total_indicators,\n    total_measures,\n  )\n\nprogram_equity_measure_counts %>%\n  arrange(desc(total_measures)) %>%\n  knitr::kable()\n```\n\n::: {.cell-output-display}\n|type |program_name                                                                                                            | total_indicators| total_measures|\n|:----|:-----------------------------------------------------------------------------------------------------------------------|----------------:|--------------:|\n|IIJA |Broadband Equity, Access, And Deployment Program                                                                        |               24|             24|\n|IIJA |Drinking Water State Revolving Fund Lead Service Lines Replacement                                                      |               24|             24|\n|IIJA |Affordable Connectivity Program                                                                                         |               24|             24|\n|IIJA |Congestion Mitigation and Air Quality Improvement Program                                                               |               24|             24|\n|IIJA |Clean Water State Revolving Fund                                                                                        |               24|             24|\n|IIJA |Drinking Water State Revolving Fund                                                                                     |               24|             24|\n|IIJA |Abandoned Mine Reclamation Fund                                                                                         |               24|             24|\n|IIJA |Power Marketing Administration Transmission Borrowing Authority                                                         |               24|             24|\n|IIJA |Regional Clean Hydrogen Hubs                                                                                            |               24|             24|\n|IIJA |Promoting Resilient Operations for Transformative, Efficient, and Cost-Saving Transportation (PROTECT) - Formula        |               24|             24|\n|IIJA |Carbon Reduction Program                                                                                                |               24|             24|\n|IIJA |Civil Nuclear Credit Program                                                                                            |               24|             24|\n|IIJA |Low or No Emission (Bus) Grants                                                                                         |               24|             24|\n|IIJA |Water Infrastructure Improvements for the Nation, Small and Underserved Communities Emerging Contaminants Grant Program |               24|             24|\n|IIJA |Preventing Outages and Enhancing the Resilience of the Electric Grid / Hazard Hardening                                 |               24|             24|\n|IIJA |Program Upgrading Our Electric Grid and Ensuring Reliability and Resiliency                                             |               24|             24|\n|IIJA |Clean School Bus Program                                                                                                |               24|             24|\n|IIJA |Orphaned Well Site Plugging, Remediation, And Restoration                                                               |               24|             24|\n|IIJA |Drinking Water State Revolving Fund Emerging Contaminants (incl. PFAS)                                                  |               24|             24|\n|IIJA |Corps of Engineers Operation and Maintenance                                                                            |               24|             24|\n|IIJA |Flood Mitigation Assistance Grants (National Flood Insurance Act Sec 1366)                                              |               24|             24|\n|IIJA |Four Regional Clean Direct Air Capture Hubs                                                                             |               24|             24|\n|IIJA |Superfund                                                                                                               |               24|             24|\n|IIJA |Indian Health Service Sanitation Facilities Construction Program                                                        |               24|             24|\n|IIJA |Weatherization Assistance Program                                                                                       |               24|             24|\n|IIJA |Aging Infrastructure Account                                                                                            |               24|             24|\n|IIJA |Battery Manufacturing and Recycling Grants                                                                              |               24|             24|\n|IIJA |Battery Materials Processing Grants                                                                                     |               24|             24|\n|IIJA |Smart Grid Investment Matching Grant Program                                                                            |               24|             24|\n|IIJA |Coastal Storm Risk Management, Hurricane, And Storm Damage Reduction Projects                                           |               24|             24|\n|IIJA |Carbon Capture Demonstration Projects Program                                                                           |               24|             24|\n|IIJA |Carbon Storage Validation and Testing                                                                                   |               24|             24|\n|IIJA |Indian Water Rights Settlements                                                                                         |               24|             24|\n|IIJA |Inland Flood Risk Management Projects                                                                                   |               24|             24|\n|IIJA |Transmission Facilitation Program                                                                                       |               24|             24|\n|IIJA |Advanced Reactor Demonstration Program                                                                                  |               24|             24|\n|IIJA |Carbon Dioxide Transportation Infrastructure Finance and Innovation Program                                             |               24|             24|\n|IIJA |Tribal Broadband Connectivity Program                                                                                   |               24|             24|\n|IIJA |Distance Learning, Telemedicine, And Broadband Program: Reconnect Program                                               |               24|             24|\n|IIJA |Aquatic Ecosystem Restoration Projects                                                                                  |               24|             24|\n|IIJA |State Digital Equity Capacity Grant                                                                                     |               24|             24|\n|IIJA |State Digital Equity Competitive Grant                                                                                  |               24|             24|\n|IIJA |Brownfields Projects                                                                                                    |               24|             24|\n|IIJA |Water & Groundwater Storage, And Conveyance                                                                             |               24|             24|\n|IIJA |Middle Mile Grant Program                                                                                               |               24|             24|\n|IIJA |State and Local Cybersecurity Grant Program                                                                             |               24|             24|\n|IIJA |Building Resilient Infrastructure and Communities (Robert T Stafford Act Section 203(i))                                |               24|             24|\n|IIJA |Clean Hydrogen Electrolysis Program                                                                                     |               24|             24|\n|IIJA |Clean Water State Revolving Fund-Emerging Contaminants                                                                  |               24|             24|\n|IIJA |Community Wildfire Defense Grant Program For At-Risk Communities                                                        |               24|             24|\n|IIJA |Geographic Programs - Great Lakes Restoration Initiative                                                                |               24|             24|\n|IIJA |Energy Improvement in Rural or Remote Areas                                                                             |               24|             24|\n|IIJA |National Culvert Removal, Replacement, & Restoration Grant                                                              |               24|             24|\n|IIJA |Natural Gas Distribution Infrastructure Safety and Modernization Grants                                                 |               24|             24|\n|IIJA |Rural Water Projects                                                                                                    |               24|             24|\n|IIJA |Water Recycling                                                                                                         |               24|             24|\n|IIJA |National Highway Performance Program                                                                                    |               23|             23|\n|IIJA |Surface Transportation Block Grant Program                                                                              |               23|             23|\n|IIJA |Federal-State Partnership for Intercity Passenger Rail Grants                                                           |               23|             23|\n|IIJA |Urbanized Area Formula Grants                                                                                           |               23|             23|\n|IIJA |Bridge Formula Program                                                                                                  |               23|             23|\n|IIJA |State of Good Repair Formula Grants                                                                                     |               23|             23|\n|IIJA |Amtrak National Network Grants                                                                                          |               23|             23|\n|IIJA |Highway Safety Improvement Program                                                                                      |               23|             23|\n|IIJA |Airport Infrastructure Grants                                                                                           |               23|             23|\n|IIJA |Bridge Investment Program                                                                                               |               23|             23|\n|IIJA |Capital Investment Grants                                                                                               |               23|             23|\n|IIJA |Local and Regional Project Assistance Grants (RAISE)                                                                    |               23|             23|\n|IIJA |Nationally Significant Freight and Highway Projects (INFRA)                                                             |               23|             23|\n|IIJA |National Highway Freight Program                                                                                        |               23|             23|\n|IIJA |Amtrak Northeast Corridor Grants                                                                                        |               23|             23|\n|IIJA |Airport Terminal Program                                                                                                |               23|             23|\n|IIJA |Consolidated Rail Infrastructure and Safety Improvement Grants                                                          |               23|             23|\n|IIJA |Facilities and Equipment                                                                                                |               23|             23|\n|IIJA |National Electric Vehicle Infrastructure Formula Program                                                                |               23|             23|\n|IIJA |National Infrastructure Project Assistance (Megaprojects)                                                               |               23|             23|\n|IIJA |Safe Streets and Roads for All                                                                                          |               23|             23|\n|IIJA |Formula Grants for Rural Areas                                                                                          |               23|             23|\n|IIJA |Real Property Activities                                                                                                |               23|             23|\n|IIJA |Bus and Bus Facilities Formula Grants                                                                                   |               23|             23|\n|IIJA |Railroad Crossing Elimination Grants                                                                                    |               23|             23|\n|IIJA |Tribal Transportation Program                                                                                           |               23|             23|\n|IIJA |Inland Waterways Projects                                                                                               |               23|             23|\n|IIJA |Motor Carrier Safety Assistance Program                                                                                 |               23|             23|\n|IIJA |Metropolitan Planning                                                                                                   |               23|             23|\n|IIJA |Port Infrastructure Development Program Grants                                                                          |               23|             23|\n|IIJA |Enhanced Mobility of Seniors and Individuals with Disabilities                                                          |               23|             23|\n|IIJA |Growing State Apportionments                                                                                            |               23|             23|\n|IIJA |Ferry Service for Rural Communities                                                                                     |               23|             23|\n|IIJA |Rural Surface Transportation Grant Program                                                                              |               23|             23|\n|IIJA |Highway Safety Programs                                                                                                 |               23|             23|\n|IIJA |Bus and Bus Facilities Competitive Grants                                                                               |               23|             23|\n|IIJA |Motor Carrier Safety Operations and Programs                                                                            |               23|             23|\n|IIJA |National Priority Safety Programs                                                                                       |               23|             23|\n|IIJA |Growing States and High-Density States Formula                                                                          |               23|             23|\n|IIJA |All Stations Accessibility Program                                                                                      |               23|             23|\n|IIJA |Federal Lands Transportation Program (funds for National Park Service)                                                  |               23|             23|\n|IIJA |Major Rehabilitation for Rivers and Harbors                                                                             |               23|             23|\n|IIJA |Rail Vehicle Replacement Grants                                                                                         |               23|             23|\n|IIJA |Federal Lands Access Program                                                                                            |               23|             23|\n|IIJA |Promoting Resilient Operations for Transformative, Efficient, and Cost-Saving Transportation (PROTECT) - Discretionary  |               23|             23|\n|IIJA |Promoting Resilient Operations for Transformative, Efficient, and Cost-Saving Transportation (PROTECT) - Discretionary  |               23|             23|\n|IIJA |Appalachian Development Highway System                                                                                  |               23|             23|\n|IIJA |Charging and Fueling Infrastructure Grants (Community Charging)                                                         |               23|             23|\n|IIJA |Charging and Fueling Infrastructure Grants (Corridor Charging)                                                          |               23|             23|\n|IIJA |Transportation Infrastructure Finance and Innovation Act                                                                |               23|             23|\n|IIJA |Railway-Highway Crossings Program                                                                                       |               23|             23|\n|IIJA |Reconnecting Communities Pilot Program                                                                                  |               23|             23|\n|HUD  |Housing Choice Voucher (Section 8)                                                                                      |               18|             20|\n|HUD  |Section 8 Housing Assistance Payments (Project Based)                                                                   |               18|             20|\n|HUD  |Public Housing Capital Fund                                                                                             |               18|             20|\n|HUD  |Public Housing Operating Fund                                                                                           |               18|             20|\n|HUD  |Continnum of Care (COC)                                                                                                 |               18|             20|\n|HUD  |HOME Formula Grants                                                                                                     |               18|             20|\n|HUD  |Community Development Block Grant (CDBG)                                                                                |               18|             18|\n|HUD  |Supportive Housing for the Elderly (Section 202)                                                                        |               18|             18|\n:::\n:::\n\n\n\nSo there are 116 individual programs in this data, and 15 baseline measures per program. Each program has an additional 2 to 9 equity measures, so we are looking at between 18 and 24 equity measures per program or thereabouts per program.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprogram_equity_measure_counts %>%\n\tsummarise(\n\t\tnumber_of_programs = n(),\n\t\taverage_indicators = mean(total_indicators),\n\t\taverage_measures = mean(total_measures),\n\t) %>%\npivot_longer(cols=everything(), names_to=\"variable\", values_to=\"value\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 2\n  variable           value\n  <chr>              <dbl>\n1 number_of_programs 116  \n2 average_indicators  23.1\n3 average_measures    23.2\n```\n:::\n:::\n\n\n## County distributions\n\nLet's see how a given county compares when plotted against the funding distribution\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexample_county <- counties_table %>%\n\tslice_sample(n = 1)\n\ncounties_table %>%\n\tggplot(aes(x = hud_per_cap, y = 0)) +\n\tgeom_point(shape = 124, size = 10, alpha = 0.2, color = \"#5C5859\") +\n\tgeom_point(data = example_county, aes(x = hud_per_cap, y = 0), shape = 124, size = 10, color = \"#F2A900\") +\n\tgeom_text(data = example_county, aes(x = hud_per_cap, y = 0, label = paste(COUNTY, STATE, \" \")), nudge_y = 0.05, size = 10, hjust = \"left\") +\n\tylim(0, 1) +\n\ttheme_minimal()\n```\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-html/plot-county-distribution-1.png){width=672}\n:::\n:::\n\n\n## Dummy need measure data\n\nI'd like to prototype a visualization of need measures for a given program, so I'm going to create some dummy data to visualize for now.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# for funding, we'll have a percentile rank for a given place, 1-100\nfunding_percentile <- floor(runif(1, min = 1, max = 100))\n\nexample_index_category <- \"Housing Production\"\n\ndummy_need_percentiles <- need_measure_index_table %>%\n\tfilter(\n\t  index_category == \"Baseline Index\" | index_category == example_index_category\n\t) %>%\n  select(indicator) %>%\n\tmutate(\n\t\tpercentile = floor(runif(n(), min = 1, max = 100)),\n\t\tfunding_percentile = funding_percentile,\n\t\tratio = funding_percentile / percentile\n\t) %>%\n\tarrange(ratio)\n\ndummy_need_percentiles$indicator <- factor(\n  dummy_need_percentiles$indicator,\n\tlevels = dummy_need_percentiles$indicator\n)\n\npoint_size <- 3\n\n\ndummy_need_percentiles %>% \n\tggplot() +\n\tgeom_segment(\n\t\taes(\n\t\t\tx = funding_percentile, \n\t\t\txend = percentile,\n\t\t\ty = indicator,\n\t\t\tyend = indicator\n\t\t),\n\t\tcolor = \"#dcdbdb\", linewidth = 2\n\t) + \n\tgeom_point(\n\t\taes(\n\t\t\tx = funding_percentile,\n\t\t\ty = indicator\n\t\t),\n\t\tcolor = \"#fdbf11\", size = point_size\n\t) +\n\tgeom_point(\n\t\taes(\n\t\t\tx = percentile,\n\t\t\ty = indicator\n\t\t),\n\t\tcolor = \"#1696d2\", size = point_size\n\t) +\n\ttheme_minimal() +\n\ttheme(\n\t\tpanel.grid.major.y = element_blank(),\n\t) +\n\txlab(\"Percentile\")\n```\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-html/create-dummy-need-measures-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "PERC-data-exploration_files/figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
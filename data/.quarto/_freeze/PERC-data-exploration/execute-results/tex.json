{
  "hash": "53693e78ae6ddcdb7740fd9d195de034",
  "result": {
    "markdown": "---\ntitle: \"PERC - Exploratory data analysis\"\nformat: pdf\n---\n\n\nWe have some preliminary data from Yonah Freemark for the PERC project and here I'd like to run through it a bit and see what we are working with. Yonah's email describes the structure of the Excel file and its tables like so:\n\n-   Dictionary: Explains the variables\n-   States: Information for each of the states (program funding levels could be put on map)\n-   Counties: Information for all counties (program funding levels could be put on map)\n-   State quintiles: Quintiles of funding for HUD and IIJA programs by underlying demographic characteristic (could be used for graph on sidebar)\n-   County quintiles: Quintiles of funding for HUD and IIJA programs by underlying demographic characteristic (could be used for graph on sidebar). Note that this is broken down for (a) all counties; (b) metro counties; (c) highly urbanized counties (which are a subset of metro counties)\n\n## Libraries\n\nLet's load the libraries we'll need to explore this data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(ggplot2)\n```\n:::\n\n\n## Load data tables\n\nLet's load each table in the sheet as a dataframe so we can see what we are working with.\n\n### Dictionary\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndictionary_table <- read_excel(\"data/full-dataset-counties-states.xlsx\", \n    sheet = \"dictionary\")\nglimpse(dictionary_table)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 79\nColumns: 2\n$ Variable <chr> \"pop\", \"race_nh_white\", \"race_nh_black\", \"race_nh_asian\", \"ra~\n$ Meaning  <chr> \"Population\", \"Share population non-Hispanic White\", \"Share p~\n```\n:::\n:::\n\n\n### States\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstates_table <- read_excel(\"data/full-dataset-counties-states.xlsx\", \n    sheet = \"states\") %>%\n  mutate(\n    FIPS = str_pad(STATEA, 2, pad = \"0\")\n  )\nglimpse(states_table)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 52\nColumns: 83\n$ GISJOIN                         <chr> \"G010\", \"G020\", \"G040\", \"G050\", \"G060\"~\n$ YEAR                            <chr> \"2016-2020\", \"2016-2020\", \"2016-2020\",~\n$ STUSAB                          <chr> \"AL\", \"AK\", \"AZ\", \"AR\", \"CA\", \"CO\", \"C~\n$ STATE                           <chr> \"Alabama\", \"Alaska\", \"Arizona\", \"Arkan~\n$ STATEA                          <dbl> 1, 2, 4, 5, 6, 8, 9, 10, 11, 12, 13, 1~\n$ GEOID                           <chr> \"04000US01\", \"04000US02\", \"04000US04\",~\n$ NAME                            <chr> \"Alabama\", \"Alaska\", \"Arizona\", \"Arkan~\n$ pop                             <dbl> 4893186, 736990, 7174064, 3011873, 393~\n$ race_nh_white                   <dbl> 0.6523658, 0.5969945, 0.5413559, 0.715~\n$ race_nh_black                   <dbl> 0.264234795, 0.030828098, 0.042649884,~\n$ race_nh_asian                   <dbl> 0.013757294, 0.062219297, 0.032484795,~\n$ race_hisp                       <dbl> 0.04351991, 0.07199419, 0.31511985, 0.~\n$ commute_drove_alone             <dbl> 0.8487310, 0.6814282, 0.7452764, 0.823~\n$ commute_transit                 <dbl> 0.003321887, 0.012086389, 0.015962010,~\n$ commute_walk_bike               <dbl> 0.01203468, 0.08432867, 0.02575513, 0.~\n$ commute_home                    <dbl> 0.04430900, 0.06028681, 0.08878461, 0.~\n$ edu_ba_plus                     <dbl> 0.2622735, 0.2998680, 0.3030708, 0.238~\n$ income_hh_median                <dbl> 52035, 77790, 61529, 49475, 78672, 752~\n$ income_public_assist            <dbl> 0.01587288, 0.06123297, 0.01800388, 0.~\n$ income_per_cap                  <dbl> 28934, 37094, 32340, 27724, 38576, 395~\n$ housing_units                   <dbl> 2270398, 318370, 3040595, 1379778, 142~\n$ housing_1_unit                  <dbl> 0.7033133, 0.7045827, 0.6895798, 0.717~\n$ housing_2_49_units              <dbl> 0.1418949, 0.2339071, 0.1528342, 0.149~\n$ housing_50_plus_units           <dbl> 0.02295280, 0.01533436, 0.05054570, 0.~\n$ housing_built_pre_1940          <dbl> 0.05089768, 0.01618557, 0.01409132, 0.~\n$ housing_built_1940_69           <dbl> 0.2338991, 0.1411440, 0.1382292, 0.204~\n$ housing_built_1970_89           <dbl> 0.3066925, 0.4905707, 0.3416081, 0.332~\n$ housing_built_1990_09           <dbl> 0.3345691, 0.2994221, 0.4338881, 0.335~\n$ housing_built_2010_plus         <dbl> 0.07394166, 0.05267770, 0.07218324, 0.~\n$ tenure_owner_shr                <dbl> 0.6918201, 0.6480936, 0.6533844, 0.658~\n$ vehicles_0_veh                  <dbl> 0.05922624, 0.09259208, 0.05825537, 0.~\n$ housing_rent_median             <dbl> 811, 1240, 1097, 760, 1586, 1335, 1201~\n$ housing_value                   <dbl> 149600, 275600, 242000, 133600, 538500~\n$ poverty_rate                    <dbl> 0.15982894, 0.10336996, 0.14124171, 0.~\n$ gini                            <dbl> 0.4777, 0.4230, 0.4661, 0.4792, 0.4874~\n$ languge_english_only            <dbl> 0.9419954, 0.8070290, 0.7240120, 0.923~\n$ travel_time_30_59               <dbl> 0.2846313, 0.1248898, 0.3006525, 0.223~\n$ travel_time_60_plus             <dbl> 0.06751786, 0.04671975, 0.07116102, 0.~\n$ vacant_shr                      <dbl> 0.16820575, 0.19850174, 0.13062082, 0.~\n$ rooms_1_plus_occupants_per_room <dbl> 0.01665180, 0.06476782, 0.04407266, 0.~\n$ rent_30_49_shr_income           <dbl> 0.2332412, 0.2514940, 0.2479936, 0.231~\n$ rent_50_plus_shr_income         <dbl> 0.2392912, 0.1904384, 0.2271691, 0.202~\n$ fta_5305_d                      <dbl> 1211845, 608712, 3491860, 609958, 2288~\n$ fta_5305_e                      <dbl> 318705, 160098, 701442, 160098, 460145~\n$ fta_5307_5340                   <dbl> 20009248, 20450418, 9032169, 15775835,~\n$ fta_5310                        <dbl> 5630579.2, 673783.0, 3411962.0, 378074~\n$ fta_5311_5340                   <dbl> 22282367, 11720612, 17147618, 17562658~\n$ fta_5311_b_3                    <dbl> 384271, 116313, 230752, 294340, 543857~\n$ fta_5311_c_3                    <dbl> 6564671, 0, 0, 0, 0, 0, 0, 0, 0, 0, 77~\n$ fta_5337_fixed                  <dbl> 0.000000e+00, 3.562681e+07, 0.000000e+~\n$ fta_5337_bus                    <dbl> 0.00, 0.00, 405558.00, 0.00, 3245972.8~\n$ fta_5339                        <dbl> 6008626, 4636723, 5135715, 5253103, 22~\n$ fta_5329_e                      <dbl> 0, 0, 1124311, 469434, 6474892, 138978~\n$ fhwa_nhpp                       <dbl> 568540380, 362707359, 519732519, 38536~\n$ fhwa_stp                        <dbl> 276587212, 176452228, 252842847, 18747~\n$ fhwa_safety                     <dbl> 59419156, 39902549, 55748698, 39684006~\n$ fhwa_railway                    <dbl> 5047891, 1225000, 3184003, 4012944, 16~\n$ fhwa_cmaq                       <dbl> 12429947, 29984491, 56525035, 13417137~\n$ fhwa_metro_plan                 <dbl> 4056177, 2991229, 7719478, 2266543, 66~\n$ fhwa_highway_freight            <dbl> 26311354, 17389323, 25374360, 17955523~\n$ fhwa_carbon                     <dbl> 24662360, 15733657, 22545154, 16716601~\n$ fhwa_protect                    <dbl> 28042870, 17890295, 25635455, 19007974~\n$ fhwa_bridge                     <dbl> 45000000, 45000000, 45000000, 60161625~\n$ fhwa_ev                         <dbl> 11738801, 7758240, 11320762, 8010850, ~\n$ fhwa_app                        <dbl> 73875000, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1~\n$ doe_bead_initial                <dbl> 1e+08, 1e+08, 1e+08, 1e+08, 1e+08, 1e+~\n$ doe_weatherization              <dbl> 3150810, 2175806, 2126768, 2529477, 83~\n$ nhtsa                           <dbl> 11222501, 5412732, 12917751, 11770328,~\n$ fmcsa_21                        <dbl> 6096415, 1236122, 350000, 4326060, 187~\n$ iija_formula_total              <dbl> 1318591186, 899852501, 1181704217, 917~\n$ cdbg_entitlement                <dbl> 13066267, 1948478, 10872027, 9070980, ~\n$ cdbg_states                     <dbl> 22197922, 2696239, 0, 18438878, 0, 937~\n$ coc                             <dbl> 14484833, 3506986, 35942449, 3434359, ~\n$ home                            <dbl> 3295184, 3748683, 1002799, 23553322, 1~\n$ public_hsg                      <dbl> 138525681, 9861007, 19713400, 31516813~\n$ public_hsg_cap                  <dbl> 98832406, 3475376, 12058294, 31077867,~\n$ elderly                         <dbl> 5555007, 1559707, 5277232, 5124102, 81~\n$ hcv                             <dbl> 232734293, 47095122, 217314643, 119727~\n$ s8_project                      <dbl> 362555406, 9447483, 81890367, 55753787~\n$ hud_total                       <dbl> 891247000, 83339081, 384071211, 297697~\n$ iija_per_cap                    <dbl> 269.4750, 1220.9833, 164.7189, 304.475~\n$ hud_per_cap                     <dbl> 182.14043, 113.08034, 53.53607, 98.841~\n$ FIPS                            <chr> \"01\", \"02\", \"04\", \"05\", \"06\", \"08\", \"0~\n```\n:::\n:::\n\n\n### Counties\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounties_table <- read_excel(\"data/full-dataset-counties-states.xlsx\", \n    sheet = \"counties\") %>%\n  mutate(\n    FIPS = paste0(str_pad(STATEA, 2, pad=\"0\"), str_pad(COUNTYA, 3, pad=\"0\"))\n  )\nglimpse(counties_table)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 3,221\nColumns: 89\n$ GISJOIN                         <chr> \"G0100010\", \"G0100030\", \"G0100050\", \"G~\n$ YEAR                            <chr> \"2016-2020\", \"2016-2020\", \"2016-2020\",~\n$ STUSAB                          <chr> \"AL\", \"AL\", \"AL\", \"AL\", \"AL\", \"AL\", \"A~\n$ STATE                           <chr> \"Alabama\", \"Alabama\", \"Alabama\", \"Alab~\n$ STATEA                          <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,~\n$ COUNTY                          <chr> \"Autauga County\", \"Baldwin County\", \"B~\n$ COUNTYA                         <dbl> 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21,~\n$ GEOID                           <chr> \"05000US01001\", \"05000US01003\", \"05000~\n$ NAME                            <chr> \"Autauga County, Alabama\", \"Baldwin Co~\n$ pop                             <dbl> 55639, 218289, 25026, 22374, 57755, 10~\n$ race_nh_white                   <dbl> 0.7397689, 0.8289699, 0.4528091, 0.744~\n$ race_nh_black                   <dbl> 0.19498913, 0.08716426, 0.47506593, 0.~\n$ race_nh_asian                   <dbl> 1.166448e-02, 9.313341e-03, 4.874930e-~\n$ race_hisp                       <dbl> 0.028774780, 0.045568031, 0.044353872,~\n$ commute_drove_alone             <dbl> 0.8670889, 0.8299656, 0.8403273, 0.876~\n$ commute_transit                 <dbl> 0.0043689126, 0.0003089662, 0.00058445~\n$ commute_walk_bike               <dbl> 0.010060523, 0.013151661, 0.023962595,~\n$ commute_home                    <dbl> 0.038238006, 0.064357659, 0.017767387,~\n$ edu_ba_plus                     <dbl> 0.2831749, 0.3190733, 0.1161432, 0.113~\n$ income_hh_median                <dbl> 57982, 61756, 34990, 51721, 48922, 338~\n$ income_public_assist            <dbl> 0.012616541, 0.007103168, 0.018343703,~\n$ income_per_cap                  <dbl> 29804, 33751, 20074, 22626, 25457, 207~\n$ housing_units                   <dbl> 23697, 116747, 12057, 9237, 24404, 459~\n$ housing_1_unit                  <dbl> 0.7344812, 0.6567021, 0.5580990, 0.609~\n$ housing_2_49_units              <dbl> 0.07541039, 0.12999906, 0.13452766, 0.~\n$ housing_50_plus_units           <dbl> 0.0051483310, 0.1089107215, 0.00472754~\n$ housing_built_pre_1940          <dbl> 0.01970714, 0.02099412, 0.07995355, 0.~\n$ housing_built_1940_69           <dbl> 0.16023125, 0.09516304, 0.25014514, 0.~\n$ housing_built_1970_89           <dbl> 0.2818078, 0.2559038, 0.3252053, 0.282~\n$ housing_built_1990_09           <dbl> 0.4463856, 0.5179748, 0.3084515, 0.351~\n$ housing_built_2010_plus         <dbl> 0.09186817, 0.10996428, 0.03624451, 0.~\n$ tenure_owner_shr                <dbl> 0.7462313, 0.7699977, 0.6195023, 0.747~\n$ vehicles_0_veh                  <dbl> 0.05413053, 0.03125632, 0.11145677, 0.~\n$ housing_rent_median             <dbl> 1011, 1032, 587, 693, 666, 559, 627, 7~\n$ housing_value                   <dbl> 161200, 211600, 86500, 96400, 135300, ~\n$ poverty_rate                    <dbl> 0.15211758, 0.09173677, 0.28599909, 0.~\n$ gini                            <dbl> 0.4552, 0.4566, 0.5047, 0.4500, 0.4685~\n$ languge_english_only            <dbl> 0.9520386, 0.9428772, 0.9269470, 0.974~\n$ travel_time_30_59               <dbl> 0.3392373, 0.3099209, 0.2312269, 0.457~\n$ travel_time_60_plus             <dbl> 0.06055428, 0.07526775, 0.11805308, 0.~\n$ vacant_shr                      <dbl> 0.09022239, 0.28009285, 0.22683918, 0.~\n$ rooms_1_plus_occupants_per_room <dbl> 0.015724291, 0.015229574, 0.037545591,~\n$ rent_30_49_shr_income           <dbl> 0.1279490, 0.2515188, 0.2633240, 0.252~\n$ rent_50_plus_shr_income         <dbl> 0.26609989, 0.20792138, 0.22370266, 0.~\n$ in_cbsa                         <dbl> 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0,~\n$ area_land_sq_mi                 <dbl> 594.4561, 1589.8359, 885.0080, 622.469~\n$ share_urban                     <dbl> 3.271244e-02, 6.552506e-02, 7.645065e-~\n$ pop_density                     <dbl> 93.59649, 137.30285, 28.27771, 35.9439~\n$ fta_5305_d                      <dbl> 14121.895, 55075.123, 6124.847, 5434.5~\n$ fta_5305_e                      <dbl> 3713.9391, 14484.2923, 1610.7829, 1429~\n$ fta_5307_5340                   <dbl> 444842.228, 0.000, 0.000, 0.000, 7352.~\n$ fta_5310                        <dbl> 94881.084, 188897.386, 21007.080, 1863~\n$ fta_5311_5340                   <dbl> 259661.30, 1012674.15, 112618.43, 9992~\n$ fta_5311_b_3                    <dbl> 4477.9940, 17464.0921, 1942.1633, 1723~\n$ fta_5311_c_3                    <dbl> 76499.55, 298346.79, 33178.83, 29439.1~\n$ fta_5337_fixed                  <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,~\n$ fta_5337_bus                    <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,~\n$ fta_5339                        <dbl> 92483.88, 221755.63, 24661.21, 21881.5~\n$ fta_5329_e                      <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,~\n$ fhwa_nhpp                       <dbl> 6625325, 25838644, 2873488, 2549611, 6~\n$ fhwa_stp                        <dbl> 3223131.3, 12570151.1, 1397913.3, 1240~\n$ fhwa_safety                     <dbl> 692424.4, 2700442.2, 300313.3, 266464.~\n$ fhwa_railway                    <dbl> 58824.18, 229413.18, 25512.80, 22637.1~\n$ fhwa_cmaq                       <dbl> 144848.89, 564907.94, 62822.82, 55741.~\n$ fhwa_metro_plan                 <dbl> 47267.518, 184342.427, 20500.528, 1818~\n$ fhwa_highway_freight            <dbl> 306611.96, 1195780.87, 132981.53, 1179~\n$ fhwa_carbon                     <dbl> 287395.88, 1120838.49, 124647.27, 1105~\n$ fhwa_protect                    <dbl> 326789.70, 1274473.65, 141732.88, 1257~\n$ fhwa_bridge                     <dbl> 524394.84, 2045129.99, 227436.76, 2018~\n$ fhwa_ev                         <dbl> 136794.82, 533497.20, 59329.66, 52642.~\n$ fhwa_app                        <dbl> 860881.5, 3357421.7, 373375.3, 331291.~\n$ doe_bead_initial                <dbl> 1165321.9, 4544733.3, 505415.0, 448448~\n$ doe_weatherization              <dbl> 36717.078, 143195.911, 15924.667, 1412~\n$ nhtsa                           <dbl> 130778.26, 510032.74, 56720.21, 50327.~\n$ fmcsa_21                        <dbl> 71042.86, 277065.80, 30812.20, 27339.2~\n$ iija_formula_total              <dbl> 15629232, 58898768, 6550070, 5811797, ~\n$ iija_formula_per_cap            <dbl> 280.9043, 269.8201, 261.7306, 259.7567~\n$ cdbg_entitlement                <dbl> 0, 0, 0, 0, 0, 0, 0, 563039, 0, 0, 0, ~\n$ cdbg_states                     <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,~\n$ coc                             <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,~\n$ home                            <dbl> 0, 0, 0, 0, 0, 0, 0, 401706, 0, 0, 0, ~\n$ public_hsg                      <dbl> 475127, 518400, 1359404, 216353, 56114~\n$ public_hsg_cap                  <dbl> 286509, 521100, 1566625, 219000, 43814~\n$ elderly                         <dbl> 0, 159666, 0, 0, 0, 0, 0, 460963, 0, 0~\n$ hcv                             <dbl> 254548, 2205011, 1411548, 0, 216619, 0~\n$ s8_project                      <dbl> 306536, 1527366, 1088425, 191472, 1337~\n$ hud_total                       <dbl> 1322720, 4931543, 5426002, 626825, 134~\n$ hud_per_cap                     <dbl> 23.773253, 22.591807, 216.814593, 28.0~\n$ FIPS                            <chr> \"01001\", \"01003\", \"01005\", \"01007\", \"0~\n```\n:::\n:::\n\n\n### State quintiles\n\nHUD funding:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstate_quintiles_hud_table <- read_excel(\"data/full-dataset-counties-states.xlsx\", \n    sheet = \"state quintiles\", range = \"A3:F18\")\nglimpse(state_quintiles_hud_table)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 15\nColumns: 6\n$ Item <chr> \"race_nh_white\", \"race_nh_black\", \"race_hisp\", \"commute_drove_alo~\n$ Q1   <dbl> 204.0629, 155.8633, 153.0100, 287.4651, 139.6788, 144.3373, 301.5~\n$ Q2   <dbl> 173.6063, 123.4197, 129.6556, 133.7693, 111.8859, 125.8810, 130.9~\n$ Q3   <dbl> 213.5611, 197.6825, 138.8155, 127.5520, 125.5510, 113.5434, 136.8~\n$ Q4   <dbl> 121.5822, 174.6759, 255.2712, 144.1039, 175.6438, 193.3995, 149.3~\n$ Q5   <dbl> 137.6761, 197.6680, 175.0994, 148.2052, 289.0320, 266.4251, 123.4~\n```\n:::\n:::\n\n\nIIJA funding:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstate_quintiles_iija_table <- read_excel(\"data/full-dataset-counties-states.xlsx\", \n    sheet = \"state quintiles\", range = \"H3:M18\")\nglimpse(state_quintiles_iija_table)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 15\nColumns: 6\n$ Item <chr> \"race_nh_white\", \"race_nh_black\", \"race_hisp\", \"commute_drove_alo~\n$ Q1   <dbl> 236.1052, 399.8261, 437.2058, 333.8366, 277.7768, 275.3679, 313.1~\n$ Q2   <dbl> 340.8208, 428.2081, 335.4166, 312.3031, 441.4476, 314.5786, 225.1~\n$ Q3   <dbl> 253.3058, 259.4077, 318.8841, 330.5941, 263.0952, 279.3651, 487.7~\n$ Q4   <dbl> 233.8969, 210.2029, 302.5101, 349.5535, 309.2734, 361.9324, 328.7~\n$ Q5   <dbl> 506.8881, 279.7170, 188.7080, 259.6774, 296.3141, 351.3957, 235.5~\n```\n:::\n:::\n\n\n### County quintiles\n\nHUD funding:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounty_quintiles_hud_table <- read_excel(\"data/full-dataset-counties-states.xlsx\", \n    sheet = \"county quintiles\", range = \"A3:G51\")\nglimpse(county_quintiles_hud_table)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 48\nColumns: 7\n$ Subset <chr> \"All counties\", \"All counties\", \"All counties\", \"All counties\",~\n$ Item   <chr> \"race_nh_white\", \"race_nh_black\", \"race_hisp\", \"commute_drove_a~\n$ Q1     <dbl> 116.37479, 46.54150, 65.63224, 94.06122, 72.29815, 92.90686, 12~\n$ Q2     <dbl> 91.51590, 53.79025, 74.84642, 71.38905, 60.47175, 69.56835, 92.~\n$ Q3     <dbl> 69.80395, 64.77230, 74.64294, 76.02926, 56.70844, 70.37444, 77.~\n$ Q4     <dbl> 57.99652, 100.03525, 81.79368, 67.96455, 63.76691, 64.86409, 55~\n$ Q5     <dbl> 49.42312, 119.86558, 88.13888, 75.62949, 131.74121, 87.34166, 3~\n```\n:::\n:::\n\nIIJA funding:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounty_quintiles_iija_table <- read_excel(\"data/full-dataset-counties-states.xlsx\", \n    sheet = \"county quintiles\", range = \"I3:O51\")\nglimpse(county_quintiles_iija_table)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 48\nColumns: 7\n$ Subset <chr> \"All counties\", \"All counties\", \"All counties\", \"All counties\",~\n$ Item   <chr> \"race_nh_white\", \"race_nh_black\", \"race_hisp\", \"commute_drove_a~\n$ Q1     <dbl> 235.6211, 307.7027, 294.0746, 342.5739, 238.4076, 230.8550, 253~\n$ Q2     <dbl> 234.3252, 286.4784, 279.9532, 252.6124, 252.8115, 253.1224, 262~\n$ Q3     <dbl> 253.9269, 259.9938, 280.5768, 243.2355, 264.2509, 263.9562, 257~\n$ Q4     <dbl> 293.5461, 226.3849, 249.8430, 238.8958, 283.5018, 265.7851, 275~\n$ Q5     <dbl> 285.5423, 222.4995, 198.6489, 225.7367, 264.0231, 289.2371, 254~\n```\n:::\n:::\n\n\n## Basic county and state distributions\n\nLet's just get a sense of the main 2 funding variables at the state and county level. Specifically, based on the dictionary, we want to look at `iija_formula_per_cap` and `hud_per_cap`. Although it seem that instead of a column for `iija_formula_per_cap` we have `iija_per_cap` in the state dataset. I am going to assume that this is the same variable with a different label for now.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstates_table %>% \n  ggplot(aes(x = iija_per_cap)) +\n  geom_histogram(binwidth = 200)\n```\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-pdf/unnamed-chunk-9-1.pdf){fig-pos='H'}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncounties_table %>% \n  ggplot(aes(x = iija_formula_per_cap)) +\n  geom_histogram()\n```\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-pdf/unnamed-chunk-10-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n## Clean up quintiles\n  \nIn order to visualize more easily, we need to re-organize the quintile data a bit. Let's start with the state-level data, since that is a bit easier.\n  \n\n::: {.cell}\n\n```{.r .cell-code}\nstate_quintiles_hud_longer <- state_quintiles_hud_table %>% \n  pivot_longer(\n    cols = Q1:Q5,\n    names_to = \"quintile\",\n    values_to = \"funding_per_capita\",\n  ) %>%\n  mutate(\n    quintile = fct_rev(factor(quintile))\n  )\n\nstate_quintiles_hud_longer\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 75 x 3\n   Item          quintile funding_per_capita\n   <chr>         <fct>                 <dbl>\n 1 race_nh_white Q1                     204.\n 2 race_nh_white Q2                     174.\n 3 race_nh_white Q3                     214.\n 4 race_nh_white Q4                     122.\n 5 race_nh_white Q5                     138.\n 6 race_nh_black Q1                     156.\n 7 race_nh_black Q2                     123.\n 8 race_nh_black Q3                     198.\n 9 race_nh_black Q4                     175.\n10 race_nh_black Q5                     198.\n# i 65 more rows\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstate_quintiles_hud_longer %>%\n  ggplot(aes(x = funding_per_capita, y = quintile)) +\n  geom_col(fill = \"#1696D2\") +\n  facet_wrap(~ Item) +\n  theme_minimal() +\n  labs(\n    title = \"State-level HUD Funding per capita\"\n  )\n```\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-pdf/unnamed-chunk-12-1.pdf){fig-pos='H'}\n:::\n:::\n\n\nNow let's do the same thing with the IIJA funding.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstate_quintiles_iija_longer <- state_quintiles_iija_table %>% \n  pivot_longer(\n    cols = Q1:Q5,\n    names_to = \"quintile\",\n    values_to = \"funding_per_capita\",\n  ) %>%\n  mutate(\n    quintile = fct_rev(factor(quintile))\n  )\n\nstate_quintiles_iija_longer\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 75 x 3\n   Item          quintile funding_per_capita\n   <chr>         <fct>                 <dbl>\n 1 race_nh_white Q1                     236.\n 2 race_nh_white Q2                     341.\n 3 race_nh_white Q3                     253.\n 4 race_nh_white Q4                     234.\n 5 race_nh_white Q5                     507.\n 6 race_nh_black Q1                     400.\n 7 race_nh_black Q2                     428.\n 8 race_nh_black Q3                     259.\n 9 race_nh_black Q4                     210.\n10 race_nh_black Q5                     280.\n# i 65 more rows\n```\n:::\n:::\n\n\nAnd let's plot those:\n  \n\n::: {.cell}\n\n```{.r .cell-code}\nstate_quintiles_iija_longer %>%\n  ggplot(aes(x = funding_per_capita, y = quintile)) +\n  geom_col(fill=\"#1696D2\") +\n  facet_wrap(~ Item) +\n  theme_minimal() +\n  labs(\n    title = \"State-level IIJA Funding per capita\"\n  )\n```\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-pdf/unnamed-chunk-14-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\nThe county-level quintiles have a few different subsets of counties:\n\n- `All counties`\n- `CBSA counties`\n- `Urban counties`\n\nWe'll probably need to plot each of these separately. For now, let's `pivot_longer()` like we did for the states. First up, HUD funding:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounty_quintiles_hud_longer <- county_quintiles_hud_table %>% \n  pivot_longer(\n    cols = Q1:Q5,\n    names_to = \"quintile\",\n    values_to = \"funding_per_capita\",\n  ) %>%\n  mutate(\n    quintile = fct_rev(factor(quintile)),\n    Subset = factor(Subset),\n    Item = factor(Item),\n  )\n\ncounty_quintiles_hud_longer\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 240 x 4\n   Subset       Item          quintile funding_per_capita\n   <fct>        <fct>         <fct>                 <dbl>\n 1 All counties race_nh_white Q1                    116. \n 2 All counties race_nh_white Q2                     91.5\n 3 All counties race_nh_white Q3                     69.8\n 4 All counties race_nh_white Q4                     58.0\n 5 All counties race_nh_white Q5                     49.4\n 6 All counties race_nh_black Q1                     46.5\n 7 All counties race_nh_black Q2                     53.8\n 8 All counties race_nh_black Q3                     64.8\n 9 All counties race_nh_black Q4                    100. \n10 All counties race_nh_black Q5                    120. \n# i 230 more rows\n```\n:::\n:::\n\n\nNow IIJA funding:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounty_quintiles_iija_longer <- county_quintiles_iija_table %>% \n  pivot_longer(\n    cols = Q1:Q5,\n    names_to = \"quintile\",\n    values_to = \"funding_per_capita\",\n  ) %>%\n  mutate(\n    quintile = fct_rev(factor(quintile)),\n    Subset = factor(Subset),\n    Item = factor(Item),\n  )\n\ncounty_quintiles_iija_longer\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 240 x 4\n   Subset       Item          quintile funding_per_capita\n   <fct>        <fct>         <fct>                 <dbl>\n 1 All counties race_nh_white Q1                     236.\n 2 All counties race_nh_white Q2                     234.\n 3 All counties race_nh_white Q3                     254.\n 4 All counties race_nh_white Q4                     294.\n 5 All counties race_nh_white Q5                     286.\n 6 All counties race_nh_black Q1                     308.\n 7 All counties race_nh_black Q2                     286.\n 8 All counties race_nh_black Q3                     260.\n 9 All counties race_nh_black Q4                     226.\n10 All counties race_nh_black Q5                     222.\n# i 230 more rows\n```\n:::\n:::\n\nAnd now let's plot each subset. First all counties:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_county_subset <- function(data, subset, funding_type) {\n  data %>%\n    filter(Subset == subset) %>%\n    ggplot(aes(x = funding_per_capita, y = quintile)) +\n    geom_col(fill=\"#1696D2\") +\n    facet_wrap(~ Item) +\n    theme_minimal() +\n    labs(\n      title = paste0(\"County-level \", funding_type, \" Funding per capita (\", subset, \")\")\n    )\n}\n\ncounty_subsets <- unique(county_quintiles_hud_longer$Subset)\n\ncounty_subsets %>%\n  map(\\(subset) plot_county_subset(county_quintiles_hud_longer, subset, \"HUD\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[[1]]\n```\n:::\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-pdf/unnamed-chunk-17-1.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n[[2]]\n```\n:::\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-pdf/unnamed-chunk-17-2.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n[[3]]\n```\n:::\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-pdf/unnamed-chunk-17-3.pdf){fig-pos='H'}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncounty_subsets %>%\n  map(\\(subset) plot_county_subset(county_quintiles_iija_longer, subset, \"IIJA\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[[1]]\n```\n:::\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-pdf/unnamed-chunk-18-1.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n[[2]]\n```\n:::\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-pdf/unnamed-chunk-18-2.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n[[3]]\n```\n:::\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-pdf/unnamed-chunk-18-3.pdf){fig-pos='H'}\n:::\n:::\n\n\n## County funding maps\n\nThe main visual component of this tool will likely be a national map displaying funding per capita for different programs. Let's take a look at some of the data mapped out for reference.\n\nFirst let's grab some geographic data:\n\n::: {.cell}\n\n```{.r .cell-code}\n# load tigris library for loading Census geographic files\nlibrary(tigris)\n# set option to use cache where possible\noptions(tigris_use_cache = TRUE)\n\n# load geography, filter out territories other than PR and apply Alaska and Hawaii shift\ncounties_geo <- counties(cb = TRUE, year = 2020) %>% \n  filter(\n    as.numeric(STATEFP) == 72 | as.numeric(STATEFP) < 60\n  ) %>%\n  shift_geometry()\n\n# join data to geography\ncounties_joined <- counties_geo %>% left_join(counties_table, by = c(\"GEOID\"=\"FIPS\"))\n```\n:::\n\n\nNow let's map some of these numbers and see what they look like.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounties_joined %>% \n  ggplot(aes(fill = iija_formula_per_cap)) +\n  geom_sf() +\n  scale_fill_viridis_c(option = \"magma\", trans = \"log\") +\n  theme_void() +\n  labs(\n    title = \"IIJA funding per capita by county\"\n  )\n```\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-pdf/unnamed-chunk-20-1.pdf){fig-pos='H'}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncounties_joined %>% \n  ggplot(aes(fill = hud_per_cap)) +\n  geom_sf() +\n  scale_fill_viridis_c(option = \"magma\", trans = \"log10\") +\n  theme_void() +\n  labs(\n    title = \"HUD funding per capita by county\"\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Transformation introduced infinite values in discrete y-axis\n```\n:::\n\n::: {.cell-output-display}\n![](PERC-data-exploration_files/figure-pdf/unnamed-chunk-21-1.pdf){fig-pos='H'}\n:::\n:::\n",
    "supporting": [
      "PERC-data-exploration_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}